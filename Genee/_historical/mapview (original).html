<!doctype html>
<html lang="en">
   <head>
		<title>Map View</title>
		<meta charset="utf-8" />
		<meta http-equiv="content-language" content="en" />
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<link type="text/css" rel="stylesheet" href="css/normalize.css" />
		<link type="text/css" rel="stylesheet" href="css/prettify.css" />
		<link type="text/css" rel="stylesheet" href="css/map-style.css" />
    </head>
    <body>
		<div class="container_16">
			<article class="grid_16">
				<div class="item rounded dark">
					<div id="map_canvas" class="map"></div>
				</div>
				<div id="radios" class="item gradient rounded shadow" style="margin:5px;padding:5px 5px 5px 10px;"></div>
				<!--<div id="tags-control" class="item gradient rounded shadow" style="margin:5px;padding:5px 5px 5px 10px;">
					<label style="color:#555;font-size:12px; font-weight:bold;" for="tags">Filter by tag</label>
					<select id="tags" style="outline:none;"></select>
				</div>-->
			</article>
		</div>

		<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script> 
		<script type="text/javascript" src="js/jquery-1.9.1.min.js"></script>
		<script type="text/javascript" src="js/underscore.min.js"></script>
		<script type="text/javascript" src="js/backbone.min.js"></script>
		<script type="text/javascript" src="js/prettify.min.js"></script>
		<script type="text/javascript" src="js/demo.js"></script>
		<script type="text/javascript" src="js/jquery.ui.map.js"></script>
		<script type="text/javascript">
ACCOUNTS_DB = [
	{
		"ranking": "1",
		"practice": "Western Oncology",
		"address": "7 Spring St, Houston, TX",
		"zipcode": "77002",
		"drivingtime": "30",
		"num_prescribers": "2",
		"num_nurses": "4",
		"num_high": "2",
		"num_med": "0",
		"num_low": "0",
		"myrating": "5",
		"r13": "0",
		"ptp": "0.13",
		"reptracx": "Yes"
	},
	{
		"ranking": "2",
		"practice": "St. Mary's Hospital",
		"address": "133 Wood Ave, Houston, TX",
		"zipcode": "77002",
		"drivingtime": "22",
		"num_prescribers": "6",
		"num_nurses": "3",
		"num_high": "2",
		"num_med": "2",
		"num_low": "2",
		"myrating": "1",
		"r13": "-0.882",
		"ptp": "0.05",
		"reptracx": "No"
	},
	{
		"ranking": "3",
		"practice": "M.D. Reeves Oncology",
		"address": "Greenspoint, TX",
		"zipcode": "77002",
		"drivingtime": "75",
		"num_prescribers": "1",
		"num_nurses": "4",
		"num_high": "0",
		"num_med": "0",
		"num_low": "1",
		"myrating": "2",
		"r13": "-0.571",
		"ptp": "0.02",
		"reptracx": "Yes"
	},
	{
		"ranking": "4",
		"practice": "St. Luke's Episcopal Hospital",
		"address": "Gulfton, TX",
		"zipcode": "77002",
		"drivingtime": "34",
		"num_prescribers": "3",
		"num_nurses": "7",
		"num_high": "1",
		"num_med": "2",
		"num_low": "0",
		"myrating": "1",
		"r13": "0.143",
		"ptp": "0.1",
		"reptracx": "No"
	},
	{
		"ranking": "5",
		"practice": "Menninger Clinic",
		"address": "Houston, TX",
		"zipcode": "77002",
		"drivingtime": "12",
		"num_prescribers": "3",
		"num_nurses": "4",
		"num_high": "2",
		"num_med": "0",
		"num_low": "1",
		"myrating": "3",
		"r13": "0.04",
		"ptp": "0",
		"reptracx": "No"
	},
	{
		"ranking": "6",
		"practice": "Hematology Oncology Associates",
		"address": "Houston, TX",
		"zipcode": "77002",
		"drivingtime": "48",
		"num_prescribers": "1",
		"num_nurses": "4",
		"num_high": "0",
		"num_med": "0",
		"num_low": "1",
		"myrating": "1",
		"r13": "-0.14",
		"ptp": "0",
		"reptracx": "Yes"
	},
	{
		"ranking": "7",
		"practice": "University of Texas M.D. Anderson Cancer Center",
		"address": "Briarforest, TX",
		"zipcode": "77002",
		"drivingtime": "56",
		"num_prescribers": "13",
		"num_nurses": "20",
		"num_high": "6",
		"num_med": "4",
		"num_low": "3",
		"myrating": "3",
		"r13": "-1",
		"ptp": "0.1",
		"reptracx": "Yes"
	},
	{
		"ranking": "8",
		"practice": "Texas Oncology",
		"address": "Houston, TX",
		"zipcode": "77002",
		"drivingtime": "27",
		"num_prescribers": "2",
		"num_nurses": "4",
		"num_high": "0",
		"num_med": "2",
		"num_low": "0",
		"myrating": "0",
		"r13": "-0.2",
		"ptp": "0",
		"reptracx": "No"
	},
	{
		"ranking": "9",
		"practice": "M.D. John Sherwood",
		"address": "Gulfton, TX",
		"zipcode": "77002",
		"drivingtime": "68",
		"num_prescribers": "1",
		"num_nurses": "3",
		"num_high": "0",
		"num_med": "0",
		"num_low": "1",
		"myrating": "2",
		"r13": "0",
		"ptp": "0.115",
		"reptracx": "No"
	},
	{
		"ranking": "10",
		"practice": "Fitzgerald & Associates",
		"address": "Houston, TX",
		"zipcode": "77002",
		"drivingtime": "27",
		"num_prescribers": "2",
		"num_nurses": "4",
		"num_high": "0",
		"num_med": "0",
		"num_low": "1",
		"myrating": "3",
		"r13": "0.5",
		"ptp": "0",
		"reptracx": "No"
	},
	{
		"ranking": "11",
		"practice": "Dr. Barry S Siller",
		"address": "Gulfton, TX",
		"zipcode": "77002",
		"drivingtime": "88",
		"num_prescribers": "1",
		"num_nurses": "1",
		"num_high": "1",
		"num_med": "2",
		"num_low": "0",
		"myrating": "2",
		"r13": "-1",
		"ptp": "0",
		"reptracx": "No"
	},
	{
		"ranking": "12",
		"practice": "M.D. Angela Del Rosario",
		"address": "Houston, TX",
		"zipcode": "77002",
		"drivingtime": "25",
		"num_prescribers": "1",
		"num_nurses": "4",
		"num_high": "1",
		"num_med": "4",
		"num_low": "1",
		"myrating": "1",
		"r13": "-1",
		"ptp": "0",
		"reptracx": "No"
	},
	{
		"ranking": "13",
		"practice": "Crossroads Convalescent Home",
		"address": "Houston, TX",
		"zipcode": "77002",
		"drivingtime": "15",
		"num_prescribers": "3",
		"num_nurses": "5",
		"num_high": "0",
		"num_med": "0",
		"num_low": "2",
		"myrating": "3",
		"r13": "0.45",
		"ptp": "0",
		"reptracx": "No"
	},
	{
		"ranking": "14",
		"practice": "Medical Clinic of Houston",
		"address": "Briarforest, TX",
		"zipcode": "77002",
		"drivingtime": "19",
		"num_prescribers": "8",
		"num_nurses": "12",
		"num_high": "0",
		"num_med": "1",
		"num_low": "0",
		"myrating": "2",
		"r13": "-0.625",
		"ptp": "0.085",
		"reptracx": "No"
	},
	{
		"ranking": "15",
		"practice": "Milan Medical Center",
		"address": "Houston, TX",
		"zipcode": "77002",
		"drivingtime": "8",
		"num_prescribers": "2",
		"num_nurses": "6",
		"num_high": "0",
		"num_med": "1",
		"num_low": "0",
		"myrating": "1",
		"r13": "-0.267",
		"ptp": "0",
		"reptracx": "No"
	},
	{
		"ranking": "16",
		"practice": "First City Hospital",
		"address": "Timbergrove, TX",
		"zipcode": "77002",
		"drivingtime": "57",
		"num_prescribers": "1",
		"num_nurses": "4",
		"num_high": "1",
		"num_med": "0",
		"num_low": "0",
		"myrating": "3",
		"r13": "0",
		"ptp": "0.2",
		"reptracx": "Yes"
	},
	{
		"ranking": "17",
		"practice": "M.D. Lawrence Foote",
		"address": "Houston, TX",
		"zipcode": "77002",
		"drivingtime": "29",
		"num_prescribers": "1",
		"num_nurses": "2",
		"num_high": "0",
		"num_med": "1",
		"num_low": "0",
		"myrating": "1",
		"r13": "0",
		"ptp": "0",
		"reptracx": "No"
	},
	{
		"ranking": "18",
		"practice": "Pulmonary Critical Care",
		"address": "Briarforest, TX",
		"zipcode": "77002",
		"drivingtime": "91",
		"num_prescribers": "1",
		"num_nurses": "5",
		"num_high": "1",
		"num_med": "0",
		"num_low": "0",
		"myrating": "3",
		"r13": "-0.273",
		"ptp": "0.06",
		"reptracx": "No"
	},
	{
		"ranking": "19",
		"practice": "St. Clara Hospital",
		"address": "Gulfton, TX",
		"zipcode": "77002",
		"drivingtime": "45",
		"num_prescribers": "1",
		"num_nurses": "4",
		"num_high": "1",
		"num_med": "0",
		"num_low": "0",
		"myrating": "2",
		"r13": "0.125",
		"ptp": "0",
		"reptracx": "No"
	},
	{
		"ranking": "20",
		"practice": "Dr. Amy A Hassan",
		"address": "Houston, TX",
		"zipcode": "77002",
		"drivingtime": "72",
		"num_prescribers": "1",
		"num_nurses": "3",
		"num_high": "1",
		"num_med": "0",
		"num_low": "0",
		"myrating": "1",
		"r13": "-1",
		"ptp": "0.04",
		"reptracx": "No"
	},
	{
		"ranking": "21",
		"practice": "Hematology Oncology Associates",
		"address": "925 Gessner Road, Houston TX",
		"zipcode": "77024",
		"drivingtime": "52",
		"num_prescribers": "2",
		"num_nurses": "2",
		"num_high": "1",
		"num_med": "1",
		"num_low": "0",
		"myrating": "2",
		"r13": "0.175",
		"ptp": "0",
		"reptracx" : "Yes"
	}
];

ACCOUNTS_COORDS = [];
for(i=0; i< ACCOUNTS_DB.length; i++){
	ACCOUNTS_COORDS.push([29.5 + Math.random(), -95.5 + Math.random()]);
}		
            $(function() { 
				demo.add(function() {			
					$('#map_canvas').gmap({'disableDefaultUI':true}).bind('init', function(evt, map) { 
						//$('#map_canvas').gmap('addControl', 'tags-control', google.maps.ControlPosition.TOP_LEFT);
						$('#map_canvas').gmap('addControl', 'radios', google.maps.ControlPosition.TOP_LEFT);
						var tags = ['High', 'Medium', 'Low', '★', '★★', '★★★', '★★★★', '★★★★★'];
						//$('#tags').append('<option value="all">All</option>');
						$.each(tags, function(i, tag) {
							//$('#tags').append(('<option value="{0}">{1}</option>').format(tag, tag));
							$('#radios').append(('<label style="margin-right:5px;display:block;"><input type="checkbox" style="margin-right:3px" value="{0}"/>{1}</label>').format(tag, tag));
						});
						for (i = 0; i < ACCOUNTS_DB.length; i++) {
							var current_record = ACCOUNTS_DB[i];
							var temp_filters = [];
							if(current_record.num_high > 0){
								temp_filters.push("High");
							}
							if(current_record.num_med > 0){
								temp_filters.push("Medium");
							}
							if(current_record.num_low > 0){
								temp_filters.push("Low");
							}
							if(current_record.myrating == 1){
								temp_filters.push("★");
							}
							else if(current_record.myrating == 2){
								temp_filters.push("★★");
							}
							else if(current_record.myrating == 3){
								temp_filters.push("★★★");
							}
							else if(current_record.myrating == 4){
								temp_filters.push("★★★★");
							}
							else if(current_record.myrating == 5){
								temp_filters.push("★★★★★");
							}
							
							temp_filters.push(current_record.my_rating);
							$('#map_canvas').gmap('addMarker', {
								'practice': current_record.practice,
								'num_high': current_record.num_high,
								'num_med': current_record.num_med,
								'num_low': current_record.num_low,
								'myrating': current_record.myrating,
								'icon': "https://chart.googleapis.com/chart?chst=d_map_pin_letter&chld=" + (i+1) + "|FFFFFF|000000",
								'tags': temp_filters, 
								'bound':true, 
								'position': new google.maps.LatLng(ACCOUNTS_COORDS[i][0], ACCOUNTS_COORDS[i][1]) } ).click( function() {											$('#map_canvas').gmap('openInfoWindow', { 
									'content': $(this)[0].practice + '<br/>' + $(this)[0].num_high + ' High, ' + $(this)[0].num_med + ' Medium, ' + $(this)[0].num_low + ' Low<br/>'
									}, 
									this);
							});
						}
						$('input:checkbox').click(function() {
							$('#map_canvas').gmap('closeInfoWindow');
							$('#map_canvas').gmap('set', 'bounds', null);
							var filters = [];
							$('input:checkbox:checked').each(function(i, checkbox) {
								filters.push($(checkbox).val());
							});
							if ( filters.length > 0 ) {
								$('#map_canvas').gmap('find', 'markers', { 'property': 'tags', 'value': filters, 'operator': 'OR' }, function(marker, found) {
									if (found) {
										$('#map_canvas').gmap('addBounds', marker.position);
									}
									marker.setVisible(found); 
								});
							} else {
								$.each($('#map_canvas').gmap('get', 'markers'), function(i, marker) {
									$('#map_canvas').gmap('addBounds', marker.position);
									marker.setVisible(true); 
								});
							}
						});
					});
				}).load();
			});
        </script>
    
	</body>
</html>